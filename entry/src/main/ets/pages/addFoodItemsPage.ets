import router from '@ohos.router'
import promptAction from '@ohos.promptAction'

// é£Ÿå“é¡¹æ¥å£
interface FoodItem {
  id: string
  name: string
  brand: string
  specification?: string
  unit: string
  price: number
  type: 'single' | 'package'  // æŒ‰ä»¶æˆ–æŒ‰é‡é‡
  isNew: boolean // æ˜¯å¦æ˜¯æ–°å“
}

@Entry
@Component
struct AddFoodItemsPage {
  @State searchText: string = ''
  @State selectedItems: Map<string, FoodItem> = new Map()
  
  private foodItems: FoodItem[] = [
    {
      id: '1',
      name: 'å¤§è‚‰',
      brand: 'å¤å¾½',
      unit: 'å…ƒ/Kg',
      price: 19.8,
      type: 'single',
      isNew: true
    },
    {
      id: '2',
      name: 'èµ¤å°è±†',
      brand: 'å†œå®¶',
      unit: 'å…ƒ/Kg',
      price: 15.6,
      type: 'single',
      isNew: true
    },
    {
      id: '3',
      name: 'å°è‚‰',
      brand: 'çˆ±å¾·å',
      specification: 'ç§°é‡',
      unit: 'å…ƒ/Kg',
      price: 15,
      type: 'single',
      isNew: true
    },
    {
      id: '4',
      name: 'è…ç«¹',
      brand: 'æµ·å¤©',
      specification: '500g*1ç®±/ä»¶',
      unit: 'å…ƒ/ä»¶',
      price: 5,
      type: 'package',
      isNew: false
    }
  ]
  
  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('â†')  // ç”¨ç®­å¤´ç¬¦å·æ›¿ä»£back_icon
          .width(24)
          .height(24)
          .fontSize(20)
          .fontColor('#FFFFFF')
          .margin({ left: 16 })
          .onClick(() => {
            promptAction.showToast({
              message: 'è¯·ç‚¹å‡»ä¸‹æ–¹ç¡®å®šæŒ‰é’®é€‰æ‹©å¹¶è¿”å›',
              duration: 2000
            })
          })
        
        Text('é…é€å•æ·»åŠ é£Ÿæ')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .margin({ left: 16 })
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
          .fontColor('#FFFFFF')
        
        Text('â‹¯')  // ç”¨çœç•¥å·ç¬¦å·æ›¿ä»£more_icon
          .width(24)
          .height(24)
          .fontSize(24)
          .fontColor('#FFFFFF')
          .margin({ right: 16 })
      }
      .width('100%')
      .height(56)
      .backgroundColor('#000000')
      
      // ç½‘ç«™æ ‡é¢˜
      Text('phone.suoeryun.com')
        .fontSize(14)
        .fontColor('#999999')
        .width('100%')
        .textAlign(TextAlign.Center)
        .backgroundColor('#000000')
        .padding({ bottom: 8 })
      
      // æœç´¢å’Œåˆ†ç±»åŒºåŸŸ
      Row() {
        Text('å…¨éƒ¨åˆ†ç±»')
          .fontSize(16)
          .fontColor('#333333')
          .margin({ left: 16 })
        
        Text('â–¼')  // ç”¨ä¸‹ç®­å¤´ç¬¦å·æ›¿ä»£arrow_down
          .width(16)
          .height(16)
          .fontSize(14)
          .fontColor('#333333')
          .margin({ left: 4 })
        
        // æœç´¢æ¡†
        Row() {
          Text('ğŸ”')  // ç”¨æ”¾å¤§é•œemojiæ›¿ä»£search_icon
            .width(20)
            .height(20)
            .fontSize(16)
            .margin({ left: 8 })
          
          TextInput({ placeholder: 'æœç´¢å•†å“åç§°', text: this.searchText })
            .width('80%')
            .height(40)
            .backgroundColor('transparent')
            .placeholderColor('#999999')
            .fontSize(14)
            .margin({ left: 8 })
            .onChange((value: string) => {
              this.searchText = value
            })
        }
        .width('70%')
        .height(46)
        .borderRadius(23)
        .backgroundColor('#FFFFFF')
        .margin({ left: 16, right: 16 })
      }
      .width('100%')
      .justifyContent(FlexAlign.Start)
      .backgroundColor('#F5F5F5')
      .padding({ top: 10, bottom: 10 })
      
      // é£Ÿæåˆ—è¡¨
      List() {
        ForEach(this.foodItems, (item: FoodItem) => {
          ListItem() {
            Column() {
              // é£Ÿæå¡ç‰‡
              Row() {
                // æ–°å“æ ‡ç­¾
                if (item.isNew) {
                  Column() {
                    Text('æ–°å“')
                      .fontSize(12)
                      .fontColor('#FFFFFF')
                      .backgroundColor('#FF9800')
                      .borderRadius({ topLeft: 8, bottomRight: 8 })
                      .padding(4)
                  }
                  .position({ x: 0, y: 0 })
                  .zIndex(1)
                } else {
                  Column() {
                    Text('ä¿ƒä»¶')
                      .fontSize(12)
                      .fontColor('#FFFFFF')
                      .backgroundColor('#2196F3')
                      .borderRadius({ topLeft: 8, bottomRight: 8 })
                      .padding(4)
                  }
                  .position({ x: 0, y: 0 })
                  .zIndex(1)
                }
                
                // é£Ÿæä¿¡æ¯
                Column() {
                  Text(item.name)
                    .fontSize(20)
                    .fontWeight(FontWeight.Bold)
                    .margin({ top: 28, bottom: 16 })
                    .alignSelf(ItemAlign.Start)
                    .width('100%')
                  
                  Row() {
                    Text('å“    ç‰Œ:')
                      .fontSize(14)
                      .fontColor('#666666')
                      .width(80)
                    
                    Text(item.brand)
                      .fontSize(14)
                      .fontColor('#333333')
                  }
                  .width('100%')
                  .margin({ top: 6, bottom: 6 })
                  .alignItems(VerticalAlign.Center)
                  
                  if (item.specification) {
                    Row() {
                      Text('è§„    æ ¼:')
                        .fontSize(14)
                        .fontColor('#666666')
                        .width(80)
                      
                      Text(item.specification)
                        .fontSize(14)
                        .fontColor('#333333')
                    }
                    .width('100%')
                    .margin({ top: 6, bottom: 6 })
                    .alignItems(VerticalAlign.Center)
                  }
                  
                  Row() {
                    Text('ä¾› åº” ä»·:')
                      .fontSize(14)
                      .fontColor('#666666')
                      .width(80)
                    
                    Text(item.price.toString() + item.unit)
                      .fontSize(16)
                      .fontColor('#FF5722')
                      .fontWeight(FontWeight.Bold)
                  }
                  .width('100%')
                  .margin({ top: 6, bottom: 6 })
                  .alignItems(VerticalAlign.Center)
                }
                .padding(16)
                .layoutWeight(1)
              }
              .width('100%')
              .backgroundColor('#FFFFFF')
              .borderRadius(8)
              .margin({ bottom: 10 })
              .onClick(() => {
                if (this.selectedItems.has(item.id)) {
                  this.selectedItems.delete(item.id)
                } else {
                  this.selectedItems.set(item.id, item)
                }
              })
              
              // é€‰ä¸­æ ‡è®°
              if (this.selectedItems.has(item.id)) {
                Text('âœ“')  // ç”¨å‹¾é€‰ç¬¦å·æ›¿ä»£check_icon
                  .width(24)
                  .height(24)
                  .fontSize(20)
                  .fontColor('#31B46A')
                  .backgroundColor('#FFFFFF')
                  .textAlign(TextAlign.Center)
                  .borderRadius(12)
                  .position({ x: '95%', y: '85%' })
              }
            }
          }
          .padding({ left: 16, right: 16 })
        })
      }
      .width('100%')
      .layoutWeight(1)
      .backgroundColor('#F5F5F5')
      
      // åº•éƒ¨ç¡®è®¤åŒºåŸŸ
      Row() {
        Text(`å·²é€‰ä¸­${this.selectedItems.size}ç§é£Ÿæ`)
          .fontSize(16)
          .fontColor('#333333')
          .margin({ left: 16 })
          .layoutWeight(1)
        
        Button('ç¡®å®š')
          .fontSize(16)
          .fontColor('#FFFFFF')
          .backgroundColor('#00C853')
          .width(120)
          .height(48)
          .borderRadius(4)
          .onClick(() => {
            // å°†é€‰ä¸­çš„é£Ÿæè½¬æ¢ä¸ºæ•°ç»„
            const selectedArray = Array.from(this.selectedItems.values())
            
            if (selectedArray.length === 0) {
              promptAction.showToast({
                message: 'è¯·é€‰æ‹©é£Ÿæ',
                duration: 2000
              })
              return
            }
            
            // è¿”å›ä¸Šä¸€é¡µå¹¶ä¼ é€’é€‰ä¸­çš„é£Ÿæ
            router.replaceUrl({
              url: 'pages/peisongdanDetailgh',
              params: {
                selectedFoodItems: selectedArray
              }
            })
          })
      }
      .width('100%')
      .height(60)
      .padding({ right: 16 })
      .backgroundColor('#FFFFFF')
      .borderWidth({ top: 1 })
      .borderColor('#EEEEEE')
    }
    .width('100%')
    .height('100%')
  }
} 